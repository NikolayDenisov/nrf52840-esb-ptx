# nrf52840-esb-ptx

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è **nRF52840 SuperMini**, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π —Ä–∞–±–æ—Ç—É **Enhanced ShockBurst (ESB)** –æ—Ç Nordic Semiconductor –≤ —Ä–µ–∂–∏–º–µ **PTX (Primary Transmitter)**.

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **nRF5 SDK 17.1.0**, —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **armgcc** –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

* –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é ESB
* –ø–µ—Ä–µ–¥–∞—á—É –ø–∞–∫–µ—Ç–æ–≤
* –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π TX/RX
* –∏–Ω–¥–∏–∫–∞—Ü–∏—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã
* –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `NRF_LOG`

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
nrf52840-esb-ptx
‚îú‚îÄ‚îÄ armgcc
‚îÇ   ‚îú‚îÄ‚îÄ esb_ptx_gcc_nrf52.ld     # Linker script
‚îÇ   ‚îî‚îÄ‚îÄ Makefile                 # –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞
‚îú‚îÄ‚îÄ config
‚îÇ   ‚îú‚îÄ‚îÄ custom_board.h           # –û–ø–∏—Å–∞–Ω–∏–µ –ø–ª–∞—Ç—ã (SuperMini)
‚îÇ   ‚îú‚îÄ‚îÄ nrf52840_mdk.h
‚îÇ   ‚îî‚îÄ‚îÄ sdk_config.h             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SDK
‚îú‚îÄ‚îÄ hex                          # –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏ (.hex)
‚îî‚îÄ‚îÄ main.c                       # –ü—Ä–∏–º–µ—Ä ESB PTX
```

---

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* nRF52840 SuperMini
* ARM GCC toolchain
* `make`
* `pyocd`
* **nRF5 SDK 17.1.0**

---

## üì¶ Nordic SDK

–°–∫–∞—á–∞–π—Ç–µ **nRF5 SDK 17.1.0** —Å —Å–∞–π—Ç–∞ Nordic Semiconductor –∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ SDK –≤ `armgcc/Makefile`:

```makefile
SDK_ROOT := /Users/nick/projects/iot/nRF5_SDK_17.1.0_ddde560/
```

> ‚ö†Ô∏è –ü—É—Ç—å –¥–æ–ª–∂–µ–Ω —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –∫–æ—Ä–µ–Ω—å SDK

---

## ‚öôÔ∏è –°–±–æ—Ä–∫–∞ –∏ –ø—Ä–æ—à–∏–≤–∫–∞

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∫–∞—Ç–∞–ª–æ–≥ `armgcc`:

```bash
cd armgcc
make
make flash
```

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:

* –±—É–¥–µ—Ç —Å–æ–±—Ä–∞–Ω `.hex` —Ñ–∞–π–ª
* –ø—Ä–æ—à–∏–≤–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≤–æ Flash nRF52840

---

## üì° –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç **ESB PTX** (–ø–µ—Ä–µ–¥–∞—Ç—á–∏–∫):

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Enhanced ShockBurst —Å Dynamic Payload Length**
* –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏: **2 Mbps**
* Auto-ACK –≤–∫–ª—é—á—ë–Ω
* –ü–µ—Ä–µ–¥–∞—á–∞ –ø–∞–∫–µ—Ç–∞ –∫–∞–∂–¥—ã–µ **5 —Å–µ–∫—É–Ω–¥**
* –°—á—ë—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ `tx_payload.data[1]`
* –°–≤–µ—Ç–æ–¥–∏–æ–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏
* –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è —á–µ—Ä–µ–∑ `NRF_LOG`

---

## üß† –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ESB

```c
nrf_esb_config.protocol = NRF_ESB_PROTOCOL_ESB_DPL;
nrf_esb_config.bitrate  = NRF_ESB_BITRATE_2MBPS;
nrf_esb_config.mode     = NRF_ESB_MODE_PTX;
nrf_esb_config.retransmit_delay = 600;
nrf_esb_config.selective_auto_ack = false;
```

–ê–¥—Ä–µ—Å–∞ ESB:

```c
base_addr_0 = { 0xE7, 0xE7, 0xE7, 0xE7 }
base_addr_1 = { 0xC2, 0xC2, 0xC2, 0xC2 }

prefixes = { 0xE7, 0xC2, 0xC3, 0xC4, 0xC5, 0xC6, 0xC7, 0xC8 }
```

---

## üì• –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π ESB

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π:

* `NRF_ESB_EVENT_TX_SUCCESS`
* `NRF_ESB_EVENT_TX_FAILED`
* `NRF_ESB_EVENT_RX_RECEIVED`

–ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–µ—Ä–µ–¥–∞—á–∏:

* TX –æ—á–µ—Ä–µ–¥—å –æ—á–∏—â–∞–µ—Ç—Å—è
* –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ

---

## üî¶ –ò–Ω–¥–∏–∫–∞—Ü–∏—è

–°–≤–µ—Ç–æ–¥–∏–æ–¥—ã –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ –±–∞–π—Ç–∞:

```c
tx_payload.data[1]++;
```

–≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Ä–∞–¥–∏–æ.

---

## üß™ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–î–ª—è –ø—Ä–∏—ë–º–∞ –ø–∞–∫–µ—Ç–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

* –≤—Ç–æ—Ä–æ–π nRF52840 –≤ —Ä–µ–∂–∏–º–µ **PRX**
* Nordic ESB PRX example
* –∫–∞—Å—Ç–æ–º–Ω—É—é –ø—Ä–æ—à–∏–≤–∫—É —Å `NRF_ESB_MODE_PRX`
